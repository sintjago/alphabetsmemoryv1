<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Memory Alphabets</title>
  <style>
    body {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background-color: #f0f0f0;
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(6, 50px);
      grid-gap: 10px;
      margin-top: 20px;
    }
    .symbol {
      width: 50px;
      height: 50px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 24px;
      border: 2px solid black;
      cursor: pointer;
      opacity: 1;
      transition: opacity 0.3s ease, background-color 0.3s ease, box-shadow 0.3s ease;
    }
    .highlight {
      background-color: yellow;
      box-shadow: 0 0 15px 5px yellow;
    }
    .clicked {
      background-color: lightgreen;
      opacity: 1;
      box-shadow: 0 0 15px 5px lightgreen;
    }
    button, select, label, #scoreDisplay {
      font-size: 16px;
    }
    button {
      padding: 8px 16px;
      cursor: pointer;
      margin-bottom: 15px;
    }
    .select-container {
      display: flex;
      justify-content: center;
      margin-bottom: 10px;
      gap: 20px;
    }
    h1 {
      margin-bottom: 20px;
      font-size: 24px;
    }
    #scoreDisplay {
      margin-top: 10px;
    }
    .button-container {
      margin-top: 20px;
      display: flex;
      gap: 10px;
    }
    .mode-container {
      margin-top: 5px;
    }
    .mode-container label {
      margin-right: 10px;
    }
    @media (max-width: 600px) {
      .grid {
        grid-template-columns: repeat(3, 50px);
      }
      .select-container {
        flex-direction: column;
        align-items: center;
      }
      .button-container {
        flex-direction: column;
        align-items: center;
      }
    }
  </style>
</head>
<body>

  <h1>Memory Alphabets - 中文</h1>

  <div class="select-container">
    <div class="speed-select">
      <label for="speed">Speed: </label>
      <select id="speed">
        <option value="1">1x</option>
        <option value="1.5">1.5x</option>
        <option value="2">2x</option>
        <option value="2.5">2.5x</option>
        <option value="3">3x</option>
      </select>
    </div>

    <div class="symbol-count-select">
      <label for="symbolCount">Characters: </label>
      <select id="symbolCount"></select>
    </div>
  </div>

  <div class="mode-container">
    <label><input type="radio" name="mode" value="alphabet+sound" checked> Character + Sound</label>
    <label><input type="radio" name="mode" value="sound-only"> Sound Only</label>
    <label><input type="radio" name="mode" value="alphabet-only"> Character Only</label>
  </div>

  <div class="grid" id="symbolGrid"></div>

  <div class="button-container">
    <button id="startGameButton">Start Game</button>
    <button id="randomizeSymbolsButton">Randomize</button>
  </div>

  <div id="gameMessage"></div>
  <div id="scoreDisplay">Points So Far: 0</div>

  <script>
    let synth = window.speechSynthesis;
    let sequence = [];
    let playerSequence = [];
    let gameInProgress = false;
    let currentRound = 0;
    let score = 0;
    let currentUtterance = null;
    let speed = 1.5;
    let gameMode = 'alphabet+sound';

    const alphabets = {
      zh: "的 一 是 不 了 在 人 有 我 他 这 个 上 们 来 到 时 大 地 为 子 中 你 说 生 国 年 着 就 那 和 要 她 出 也 得 里 后 自 以 会 家 可 下 而 过 天 去 能 对 小 多 然 于 心 学 之 都 好 看 起 发 工 向 种 面 情 重 走 它 与 长 会 回 被 很 还 进 此 话 已 事 把 看 没 日 真 全 明 但 只 现 分 想 再 有 点 主 什 东 使 路 信".split(" ")
    };

    const symbolsContainer = document.getElementById('symbolGrid');
    const symbolCountSelect = document.getElementById('symbolCount');

    function populateSymbolCountOptions(language) {
      const alphabet = alphabets[language];
      symbolCountSelect.innerHTML = '';
      for (let i = 1; i <= alphabet.length; i++) {
        const option = document.createElement('option');
        option.value = i;
        option.textContent = i === alphabet.length ? `Max (${i})` : i;
        symbolCountSelect.appendChild(option);
      }
      symbolCountSelect.value = 6;
    }

    function generateSymbolGrid(selectedCount) {
      symbolsContainer.innerHTML = '';
      const alphabet = alphabets["zh"];
      const shuffled = [...alphabet].sort(() => Math.random() - 0.5).slice(0, selectedCount);
      shuffled.forEach(letter => {
        const symbolDiv = document.createElement('div');
        symbolDiv.className = 'symbol';
        symbolDiv.textContent = letter;
        symbolDiv.onclick = () => handleSymbolClick(symbolDiv);
        symbolsContainer.appendChild(symbolDiv);
      });
    }

    function highlightSymbol(symbolDiv) {
      if (gameMode !== 'sound-only') {
        symbolDiv.classList.add('highlight');
        setTimeout(() => {
          symbolDiv.classList.remove('highlight');
        }, 500 / speed);
      }
    }

    function clickFeedback(symbolDiv) {
      symbolDiv.classList.add('clicked');
      setTimeout(() => {
        symbolDiv.classList.remove('clicked');
      }, 500);
    }

    function speakSymbol(symbol) {
      if (currentUtterance) synth.cancel();
      currentUtterance = new SpeechSynthesisUtterance(symbol);
      currentUtterance.lang = 'zh-CN';
      currentUtterance.rate = speed;
      synth.speak(currentUtterance);
    }

    function getRandomSymbol() {
      const randomIndex = Math.floor(Math.random() * symbolsContainer.children.length);
      return symbolsContainer.children[randomIndex];
    }

    function playSequence() {
      let index = 0;
      const intervalId = setInterval(() => {
        if (index >= sequence.length) {
          clearInterval(intervalId);
          return;
        }
        const symbolDiv = sequence[index];
        highlightSymbol(symbolDiv);
        if (gameMode !== 'alphabet-only') {
          speakSymbol(symbolDiv.textContent);
        }
        index++;
      }, 1000 / speed);
    }

    function startGame() {
      gameInProgress = true;
      score = 0;
      sequence = [];
      currentRound = 0;
      playerSequence = [];
      document.getElementById('gameMessage').textContent = '';
      document.getElementById('scoreDisplay').textContent = `Points So Far: ${score}`;
      nextRound();
    }

    function nextRound() {
      currentRound++;
      playerSequence = [];
      const newSymbol = getRandomSymbol();
      sequence.push(newSymbol);
      setTimeout(playSequence, 1000 / speed);
    }

    function updateScore() {
      score += currentRound * 10 * speed;
      document.getElementById('scoreDisplay').textContent = `Points So Far: ${score}`;
    }

    function endGame() {
      gameInProgress = false;
      document.getElementById('gameMessage').textContent = `Game Over! Your total score: ${score}`;
    }

    function handleSymbolClick(symbolDiv) {
      clickFeedback(symbolDiv);
      speakSymbol(symbolDiv.textContent);
      if (!gameInProgress) return;
      playerSequence.push(symbolDiv);
      const currentStep = playerSequence.length - 1;
      if (symbolDiv !== sequence[currentStep]) {
        endGame();
        return;
      }
      if (playerSequence.length === sequence.length) {
        updateScore();
        nextRound();
      }
    }

    function refreshGrid() {
      const selectedCount = parseInt(symbolCountSelect.value);
      generateSymbolGrid(selectedCount);
    }

    document.getElementById('symbolCount').addEventListener('change', refreshGrid);

    document.querySelectorAll('input[name="mode"]').forEach(radio => {
      radio.addEventListener('change', () => {
        gameMode = document.querySelector('input[name="mode"]:checked').value;
        refreshGrid();
      });
    });

    document.getElementById('startGameButton').addEventListener('click', startGame);

    document.getElementById('speed').addEventListener('change', (event) => {
      speed = parseFloat(event.target.value);
    });

    document.getElementById('randomizeSymbolsButton').addEventListener('click', refreshGrid);

    // Initialize the grid for Chinese
    populateSymbolCountOptions("zh");
    generateSymbolGrid(6);
  </script>

</body>
</html>
